pipeline {
    agent any
environment {
    PATH = "$PATH:${getTerraformPath()}"
}
    stages {
        stage('Terraform-Init') {
            steps {
                sh 'terraform init'
            }
        }
        stage('Terraform-Apply') {
            steps {
                sh 'terraform apply --auto-approve'
            }
        }
        stage('Ansible Create Bucket') {
            steps {
                sh 'aws s3 mb s3://prathamcloudit.com --region ap-south-1'
            }
        }
    }
}

def getTerraformPath(){
    def tfHome= tool name: 'terraform-server', type: 'terraform'
    return tfHome
}
